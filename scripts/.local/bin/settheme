#!/usr/bin/env bash

CONFIG_DIR="${XDG_CONFIG_DIR:-$HOME/.config}"
WALLPAPER_FILE="${XDG_CONFIG_DIR:-$HOME/.config}/wallpaper.png"

function restart_prog() {
	if [ ! -z "$(pidof $1)" ]; then
		killall $1
		nohup >/dev/null $1 2>&1 &
	fi
}

# generate colorschemes
if command -v colorz >/dev/null && [ -f "${WALLPAPER_FILE}" ]; then
	tmpfile=$(mktemp)
	active=$(colorz "${WALLPAPER_FILE}" --no-preview | tr " " "\n" | sed 's/#//g' | awk '{if (NR == 2) {print $1}}')
	cat > "${tmpfile}" <<-EOF
general {
    col.active_border = rgb($active)
}
EOF
	mv "${tmpfile}" "${CONFIG_DIR}/hypr/colors.conf"
	touch "${CONFIG_DIR}/hypr/colors.conf"
fi

restart_prog dunst
