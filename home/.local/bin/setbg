#!/usr/bin/env bash
# sets hyprpaper background and colorscheme
# does exaclty what you think it does

[ -z $1 ] && exit 1

CONFIG_DIR="${XDG_CONFIG_DIR:-$HOME/.config}"
WALLPAPER_FILE="${XDG_CONFIG_DIR:-$HOME/.config}/wallpaper.png"

command -v magick >/dev/null || exit 0

magick "${1}" "${WALLPAPER_FILE}"

# generate colorschemes
if command -v colorz >/dev/null && [ -f "${WALLPAPER_FILE}" ]; then
	tmpfile=$(mktemp)
	active=$(colorz "${WALLPAPER_FILE}" --no-preview | tr " " "\n" | sed 's/#//g' | awk '{if (NR == 2) {print $1}}')
	cat > "${tmpfile}" <<-EOF
general {
    col.active_border = rgb($active)
}
EOF
	mv "${tmpfile}" "${CONFIG_DIR}/hypr/colors.conf"
	touch "${CONFIG_DIR}/hypr/colors.conf"
fi

if [ ! -z "$(ps aux | grep hyprpaper)" ]; then
	killall hyprpaper
	nohup >/dev/null hyprpaper 2>&1 &
fi
